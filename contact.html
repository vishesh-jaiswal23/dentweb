<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contact Dakshayani Enterprises | Get a Solar Quote</title>
  <meta name="description" content="Get in touch with Dakshayani Enterprises for a free solar quote, site survey, or support. Based in Ranchi, serving Jharkhand."/>

  <link rel="icon" href="images/favicon.ico" />
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>
</head>
<body>

  <header class="site-header"></header>

  <main>
    <section class="page-hero" style="background:linear-gradient(135deg,rgba(15,23,42,0.92),rgba(20,83,45,0.85));">
      <div class="container hero-inner">
        <div class="hero-copy">
          <span class="hero-eyebrow"><i class="fa-solid fa-envelope"></i> Quote / contact</span>
          <h1>Let&#39;s design your next solar milestone</h1>
          <p class="lead" style="color:rgba(255,255,255,0.85);">Share your load profile or subsidy query and our team will respond within one business day.</p>
          <div class="hero-metrics">
            <div class="hero-metric">
              <span>24 hrs</span>
              <span>Average response</span>
            </div>
            <div class="hero-metric">
              <span>3 Teams</span>
              <span>Sales · Engineering · Support</span>
            </div>
            <div class="hero-metric">
              <span>100%</span>
              <span>Portal-backed updates</span>
            </div>
          </div>
        </div>
        <div class="hero-media" aria-hidden="true">
          <img src="images/team.jpg" alt="Customer success team assisting clients" loading="lazy" />
          <div class="caption">Customer success desk · Ranchi</div>
        </div>
      </div>
    </section>

    <section class="section alt">
      <div class="container contact-grid">
        <div class="form-card">
          <h2 style="margin:0;">Request a free consultation</h2>
          <form id="contactForm">
            <input type="text" name="Company" id="contactCompany" autocomplete="off" tabindex="-1" aria-hidden="true" data-honeypot style="position:absolute;left:-9999px;opacity:0;height:0;width:0;" />
            <div class="form-group">
              <label for="name">Full name</label>
              <input type="text" id="name" name="Name" required />
            </div>
            <div class="form-grid cols-2">
              <div class="form-group">
                <label for="email">Email address</label>
                <input type="email" id="email" name="Email" required />
              </div>
              <div class="form-group">
                <label for="phone">Phone number</label>
                <input type="tel" id="phone" name="Phone" required />
              </div>
            </div>
            <div class="form-group">
              <label for="project-type">Project type</label>
              <select id="project-type" name="ProjectType" required>
                <option value="">Select an option</option>
                <option value="Residential">Residential rooftop</option>
                <option value="Commercial">Commercial / institutional</option>
                <option value="Industrial">Industrial EPC</option>
                <option value="Hydrogen">Meera GH2 / hydrogen</option>
                <option value="General">General inquiry</option>
              </select>
            </div>
            <div class="form-group">
              <label for="contactAttachments">Supporting documents <span class="form-helper">(optional, max 5&nbsp;MB total)</span></label>
              <input type="file" id="contactAttachments" name="Attachments" accept=".pdf,.jpg,.jpeg,.png" multiple data-max-total="5242880" />
              <p class="form-helper">Attach electricity bills or site photos to help our engineers prepare before they call.</p>
            </div>
            <div class="form-group">
              <label for="message">How can we help?</label>
              <textarea id="message" name="Message" rows="4" placeholder="Tell us about your site, energy bills, or subsidy stage." required></textarea>
            </div>
            <fieldset class="form-group" style="border:none;padding:0;">
              <legend style="font-weight:600;margin-bottom:0.5rem;">Preferred channel</legend>
              <div class="form-grid" style="grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:0.75rem;">
                <label class="btn btn-secondary" style="margin:0;display:flex;align-items:center;gap:0.5rem;justify-content:center;cursor:pointer;">
                  <input type="radio" name="ContactChannel" value="whatsapp" required style="accent-color:#14532d;" />
                  WhatsApp
                </label>
                <label class="btn btn-secondary" style="margin:0;display:flex;align-items:center;gap:0.5rem;justify-content:center;cursor:pointer;">
                  <input type="radio" name="ContactChannel" value="sms" required style="accent-color:#14532d;" />
                  SMS
                </label>
                <label class="btn btn-secondary" style="margin:0;display:flex;align-items:center;gap:0.5rem;justify-content:center;cursor:pointer;">
                  <input type="radio" name="ContactChannel" value="email" required style="accent-color:#14532d;" />
                  Email
                </label>
              </div>
            </fieldset>
            <button type="submit" class="btn btn-primary">Submit request</button>
            <p class="form-helper">We&#39;ll call or email within one working day. For urgent assistance, WhatsApp +91&nbsp;70702&nbsp;78178.</p>
          </form>
        </div>
        <aside class="contact-detail-card">
          <h2 style="margin:0;">Direct contact</h2>
          <div class="contact-detail-item">
            <span class="contact-detail-icon"><i class="fa-solid fa-phone"></i></span>
            <div>
              <strong>Phone / WhatsApp</strong>
              <p class="mb-0">+91&nbsp;70702&nbsp;78178</p>
              <p class="form-helper">Mon–Sat · 9 AM – 7 PM</p>
            </div>
          </div>
          <div class="contact-detail-item">
            <span class="contact-detail-icon"><i class="fa-solid fa-envelope"></i></span>
            <div>
              <strong>Email</strong>
              <p class="mb-0"><a href="mailto:connect@dakshayani.co.in">connect@dakshayani.co.in</a></p>
            </div>
          </div>
          <div class="contact-detail-item">
            <span class="contact-detail-icon"><i class="fa-solid fa-location-dot"></i></span>
            <div>
              <strong>Office</strong>
              <p class="mb-0">Maa Tara, Kilburn Colony, Hinoo, Ranchi, Jharkhand</p>
            </div>
          </div>
          <div class="contact-detail-item">
            <span class="contact-detail-icon"><i class="fa-solid fa-clock"></i></span>
            <div>
              <strong>Support timings</strong>
              <p class="mb-0">Portal + WhatsApp support available all 7 days.</p>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <section class="section" id="service-complaints">
      <div class="container">
        <div class="head">
          <h2>Register a service complaint</h2>
          <p class="sub">Raise an issue with your solar system and our service desk will log it over WhatsApp, email, and the Dakshayani helpdesk so nothing slips through.</p>
        </div>
        <div class="complaint-layout">
          <div class="form-card complaint-card">
            <form id="complaintForm">
              <div class="form-grid cols-2">
                <div class="form-group">
                  <label for="complaintName">Customer name</label>
                  <input type="text" id="complaintName" name="ComplaintName" required />
                </div>
                <div class="form-group">
                  <label for="complaintPhone">Phone number</label>
                  <input type="tel" id="complaintPhone" name="ComplaintPhone" required />
                  <p class="form-helper" id="complaintLookupStatus" aria-live="polite"></p>
                </div>
              </div>
              <div class="form-grid cols-2">
                <div class="form-group">
                  <label for="complaintEmail">Email address <span class="form-helper">(optional)</span></label>
                  <input type="email" id="complaintEmail" name="ComplaintEmail" placeholder="name@example.com" />
                </div>
                <div class="form-group">
                  <label for="installType">Installation category</label>
                  <select id="installType" name="InstallType" required>
                    <option value="">Select an installation type</option>
                    <option value="pmsgby">PM Surya Ghar Muft Bijli Yojana</option>
                    <option value="private">Non-PMSGMBY private installations</option>
                    <option value="government">Government installations</option>
                  </select>
                </div>
              </div>
              <div class="form-grid cols-2">
                <div class="form-group">
                  <label for="complaintScheme">Is this a PM Surya Ghar Muft Bijli Yojana installation?</label>
                  <select id="complaintScheme" name="SchemeType" required>
                    <option value="">Select an option</option>
                    <option value="pmsgby">Yes, PM Surya Ghar Muft Bijli Yojana</option>
                    <option value="other">No, other installation</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="systemConfiguration">System configuration</label>
                  <select id="systemConfiguration" name="SystemConfiguration" required disabled>
                    <option value="">Select system configuration</option>
                  </select>
                  <p class="form-helper">Choose on-grid, hybrid, or off-grid. PM Surya Ghar installations support only on-grid or hybrid.</p>
                </div>
              </div>
              <div class="form-group is-hidden" id="applicationNumberGroup" data-field="application-number">
                <label for="applicationNumber">PM Surya Ghar application number</label>
                <input type="text" id="applicationNumber" name="ApplicationNumber" placeholder="e.g. PMSBY-1234567" />
              </div>
              <div class="form-group">
                <label for="siteAddress">Site address</label>
                <textarea id="siteAddress" name="SiteAddress" rows="2" placeholder="Installation location, city, landmark" required></textarea>
              </div>
              <div class="form-group">
                <label for="systemSize">Solar plant size</label>
                <input type="text" id="systemSize" name="SystemSize" placeholder="e.g. 5 kW rooftop" required />
              </div>
              <fieldset class="form-group" style="border:none;padding:0;">
                <legend style="font-weight:600;margin-bottom:0.5rem;">What is affected?</legend>
                <div class="issue-grid">
                  <label class="issue-chip"><input type="checkbox" name="issueType" value="solar-panels" data-label="Solar panels" /> Solar panels</label>
                  <label class="issue-chip"><input type="checkbox" name="issueType" value="inverter" data-label="Inverter" /> Inverter</label>
                  <label class="issue-chip"><input type="checkbox" name="issueType" value="battery" data-label="Battery bank" /> Batteries / storage</label>
                  <label class="issue-chip"><input type="checkbox" name="issueType" value="wiring" data-label="Wiring" /> Wiring</label>
                  <label class="issue-chip"><input type="checkbox" name="issueType" value="earthing" data-label="Earthing" /> Earthing</label>
                  <label class="issue-chip"><input type="checkbox" name="issueType" value="net-metering" data-label="Net Metering / Export Mode" /> Net Metering / Export Mode</label>
                  <label class="issue-chip"><input type="checkbox" name="issueType" value="monitoring" data-label="Monitoring / portal" /> Monitoring / portal</label>
                </div>
              </fieldset>
              <div class="form-group">
                <label for="uniqueIssue">Describe the issue</label>
                <textarea id="uniqueIssue" name="UniqueIssue" rows="4" placeholder="Explain the problem, error codes, downtime duration, photos shared, etc."></textarea>
                <p class="form-helper">Pick at least one affected area or describe the concern in detail so we can route the ticket correctly.</p>
              </div>
              <div class="form-group">
                <label for="preferredContact">Preferred update channel</label>
                <select id="preferredContact" name="PreferredContact">
                  <option value="">No preference</option>
                  <option value="whatsapp">WhatsApp</option>
                  <option value="call">Phone call</option>
                  <option value="email">Email</option>
                </select>
              </div>
              <p class="form-helper form-error is-hidden" id="complaintError" role="alert"></p>
              <div class="complaint-actions">
                <button type="button" class="btn btn-primary" id="complaintSendWhatsApp"><i class="fa-brands fa-whatsapp"></i> Send via WhatsApp</button>
                <button type="button" class="btn btn-secondary" id="complaintSendEmail"><i class="fa-solid fa-envelope"></i> Send email ticket</button>
              </div>
            </form>
          </div>
          <aside class="support-note">
            <h3>Need immediate help?</h3>
            <p class="mb-2">Our service desk logs every complaint to WhatsApp <strong>+91&nbsp;81024&nbsp;01427</strong> and emails <strong>dakshayani.pmsgy@gmail.com</strong> (cc <strong>connect@dakshayani.co.in</strong>).</p>
            <p class="mb-2">You can also call <strong>+91&nbsp;81024&nbsp;01427</strong>, but if the call doesn&rsquo;t connect please still log the complaint here so it is registered.</p>
            <p class="mb-2">Screenshots or meter readings shared over WhatsApp help us triage faster. Our technicians prioritise PM Surya Ghar subsidy plants, followed by private and government installations.</p>
            <p class="form-helper mb-0">Average acknowledgment time: under 2 working hours during 9 AM&ndash;7 PM.</p>
          </aside>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <div class="head">
          <h2>Choose the right support lane</h2>
          <p class="sub">We route every inquiry to the right specialist across sales, engineering, finance, or décor management.</p>
        </div>
        <div class="feature-grid">
          <article class="feature-card">
            <i class="fa-solid fa-house"></i>
            <h3>Homeowners &amp; housing societies</h3>
            <p>Book a rooftop survey, understand PM Surya Ghar subsidies, and receive a payback projection.</p>
            <a href="calculator.html" class="btn btn-secondary" style="justify-content:flex-start;">Estimate savings</a>
          </article>
          <article class="feature-card">
            <i class="fa-solid fa-building"></i>
            <h3>Businesses &amp; institutions</h3>
            <p>Schedule feasibility studies, tender support, and hybrid system design for petrol pumps, hospitals, or campuses.</p>
            <a href="solar-projects.html#case-studies" class="btn btn-secondary" style="justify-content:flex-start;">View case studies</a>
          </article>
          <article class="feature-card">
            <i class="fa-solid fa-network-wired"></i>
            <h3>Partners, installers &amp; staff</h3>
            <p>Access portal onboarding, décor control updates, and training resources for your team.</p>
          </article>
        </div>
      </div>
    </section>

    <section class="section alt">
      <div class="container">
        <div class="head">
          <h2>Service benchmarks</h2>
          <p class="sub">We measure every interaction to keep our support responsive and dependable.</p>
        </div>
        <div class="stat-grid">
          <div class="stat-card">
            <div class="stat-label">Response time</div>
            <div class="stat-value">24 hrs</div>
            <p class="mb-0">Average turnaround for new inquiries and quote requests.</p>
          </div>
          <div class="stat-card">
            <div class="stat-label">Customer satisfaction</div>
            <div class="stat-value">98%</div>
            <p class="mb-0">Portal tickets resolved with positive feedback in 2024.</p>
          </div>
          <div class="stat-card">
            <div class="stat-label">Projects delivered</div>
            <div class="stat-value">500+</div>
            <p class="mb-0">Rooftop and EPC systems energised across Jharkhand.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <div class="cta-panel">
          <div>
            <span class="hero-eyebrow" style="background:rgba(255,255,255,0.16);color:#fff;">Prefer a direct call?</span>
            <h2 style="color:var(--surface);margin-bottom:0.5rem;">Speak with our solar advisors now</h2>
            <p class="lead" style="color:rgba(255,255,255,0.82);">Dial +91&nbsp;70702&nbsp;78178 or drop your query via WhatsApp for instant support.</p>
          </div>
          <div class="cta-actions">
            <a href="tel:+917070278178" class="btn btn-primary">Call +91&nbsp;70702&nbsp;78178</a>
            <a href="https://wa.me/917070278178" class="btn btn-secondary" style="background:transparent;border-color:rgba(255,255,255,0.45);color:var(--surface);">Message on WhatsApp</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer"></footer>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('contactForm');
      if (form) {
        form.addEventListener('submit', function (event) {
          event.preventDefault();

          const formData = new FormData(form);
          const honeypot = form.querySelector('[data-honeypot]');
          if (honeypot && honeypot.value.trim() !== '') {
            return;
          }

          const attachmentsInput = form.querySelector('#contactAttachments');
          if (attachmentsInput && attachmentsInput.files && attachmentsInput.files.length) {
            const maxTotal = Number(attachmentsInput.dataset.maxTotal || 5242880);
            const total = Array.from(attachmentsInput.files).reduce((sum, file) => sum + (file.size || 0), 0);
            if (total > maxTotal) {
              alert('Please keep attachments under 5 MB.');
              return;
            }
          }

          const name = (formData.get('Name') || '').trim();
          const email = (formData.get('Email') || '').trim();
          const phone = (formData.get('Phone') || '').trim();
          const projectType = formData.get('ProjectType') || '';
          const message = (formData.get('Message') || '').trim();
          const channel = formData.get('ContactChannel');

          const attachmentSummary = [];
          const attachmentsField = form.querySelector('#contactAttachments');
          if (attachmentsField && attachmentsField.files && attachmentsField.files.length) {
            Array.from(attachmentsField.files).forEach((file) => {
              const sizeKb = Math.round((file.size || 0) / 1024);
              attachmentSummary.push(`${file.name} (${sizeKb} KB)`);
            });
          }

          if (!channel) {
            form.reportValidity();
            return;
          }

          const summary = [
            `Name: ${name}`,
            `Email: ${email}`,
            `Phone: ${phone}`,
            `Project type: ${projectType}`,
            attachmentSummary.length ? `Attachments: ${attachmentSummary.join(', ')}` : null,
            '',
            'Message:',
            message
          ].filter(Boolean).join('\n');

          let targetUrl = '';

          if (channel === 'whatsapp') {
            targetUrl = `https://wa.me/917070278178?text=${encodeURIComponent(summary)}`;
          } else if (channel === 'sms') {
            targetUrl = `sms:7070278178?body=${encodeURIComponent(summary)}`;
          } else {
            const subject = encodeURIComponent(`New solar inquiry from ${name || 'Dakshayani contact form'}`);
            targetUrl = `mailto:connect@dakshayani.co.in?subject=${subject}&body=${encodeURIComponent(summary)}`;
          }

          window.location.href = targetUrl;
        });
      }

      const complaintForm = document.getElementById('complaintForm');
      if (!complaintForm) {
        return;
      }

      const installType = complaintForm.querySelector('#installType');
      const applicationGroup = complaintForm.querySelector('#applicationNumberGroup');
      const applicationInput = complaintForm.querySelector('#applicationNumber');
      const complaintError = document.getElementById('complaintError');
      const issueInputs = complaintForm.querySelectorAll('input[name="issueType"]');
      const whatsappButton = document.getElementById('complaintSendWhatsApp');
      const emailButton = document.getElementById('complaintSendEmail');
      const complaintNameInput = complaintForm.querySelector('#complaintName');
      const complaintPhoneInput = complaintForm.querySelector('#complaintPhone');
      const complaintEmailInput = complaintForm.querySelector('#complaintEmail');
      const siteAddressInput = complaintForm.querySelector('#siteAddress');
      const systemSizeInput = complaintForm.querySelector('#systemSize');
      const preferredContactInput = complaintForm.querySelector('#preferredContact');
      const lookupStatus = document.getElementById('complaintLookupStatus');
      const schemeSelect = complaintForm.querySelector('#complaintScheme');
      const systemConfigurationSelect = complaintForm.querySelector('#systemConfiguration');

      const SCHEME_LABELS = {
        pmsgby: 'PM Surya Ghar Muft Bijli Yojana',
        other: 'Other installation'
      };

      const SYSTEM_CONFIGURATION_LABELS = {
        ongrid: 'On-grid',
        hybrid: 'Hybrid',
        offgrid: 'Off-grid'
      };

      const SYSTEM_CONFIGURATION_OPTIONS = {
        pmsgby: [
          { value: '', label: 'Select system configuration', disabled: true },
          { value: 'ongrid', label: SYSTEM_CONFIGURATION_LABELS.ongrid },
          { value: 'hybrid', label: SYSTEM_CONFIGURATION_LABELS.hybrid }
        ],
        other: [
          { value: '', label: 'Select system configuration', disabled: true },
          { value: 'ongrid', label: SYSTEM_CONFIGURATION_LABELS.ongrid },
          { value: 'hybrid', label: SYSTEM_CONFIGURATION_LABELS.hybrid },
          { value: 'offgrid', label: SYSTEM_CONFIGURATION_LABELS.offgrid }
        ]
      };

      const normaliseSystemConfigurationValue = (value) => {
        const raw = (value || '').toString().trim().toLowerCase();
        if (!raw) {
          return '';
        }

        if (raw.includes('off')) {
          return 'offgrid';
        }
        if (raw.includes('hybrid')) {
          return 'hybrid';
        }
        if (raw.includes('grid') || raw.includes('net')) {
          return 'ongrid';
        }
        if (raw.includes('battery')) {
          return 'hybrid';
        }

        return raw.replace(/[^a-z]/g, '');
      };

      const buildSystemConfigurationOptions = (schemeKey) => {
        if (schemeKey === 'pmsgby') {
          return SYSTEM_CONFIGURATION_OPTIONS.pmsgby;
        }
        if (schemeKey === 'other') {
          return SYSTEM_CONFIGURATION_OPTIONS.other;
        }
        return [{ value: '', label: 'Select system configuration', disabled: true }];
      };

      const updateSystemConfigurationOptions = (preferredValue = '') => {
        if (!systemConfigurationSelect) {
          return;
        }

        const schemeValue = schemeSelect && schemeSelect.value
          ? schemeSelect.value
          : (installType && installType.value === 'pmsgby' ? 'pmsgby' : '');
        const schemeKey = schemeValue === 'pmsgby' ? 'pmsgby' : schemeValue === 'other' ? 'other' : '';
        const currentValue = normaliseSystemConfigurationValue(preferredValue || systemConfigurationSelect.value);
        const optionDefinitions = buildSystemConfigurationOptions(schemeKey);

        systemConfigurationSelect.innerHTML = '';
        optionDefinitions.forEach((definition) => {
          const option = document.createElement('option');
          option.value = definition.value;
          option.textContent = definition.label;
          if (definition.disabled) {
            option.disabled = true;
            option.selected = true;
          }
          systemConfigurationSelect.appendChild(option);
        });

        if (!schemeKey) {
          systemConfigurationSelect.value = '';
          systemConfigurationSelect.disabled = true;
          systemConfigurationSelect.required = false;
          return;
        }

        systemConfigurationSelect.disabled = false;
        systemConfigurationSelect.required = true;

        if (currentValue && systemConfigurationSelect.querySelector(`option[value="${currentValue}"]`)) {
          systemConfigurationSelect.value = currentValue;
        } else {
          systemConfigurationSelect.value = '';
        }
      };

      const getSchemeLabel = (value) => SCHEME_LABELS[value] || value || '';
      const getSystemConfigurationLabel = (value) => SYSTEM_CONFIGURATION_LABELS[value] || value || '';

      let lastNonPmsgInstallType = installType && installType.value && installType.value !== 'pmsgby'
        ? installType.value
        : 'private';

      const syncSchemeFromInstall = () => {
        if (!installType || !schemeSelect) {
          updateSystemConfigurationOptions();
          return;
        }

        if (installType.value === 'pmsgby') {
          if (schemeSelect.value !== 'pmsgby') {
            schemeSelect.value = 'pmsgby';
          }
        } else if (installType.value !== '') {
          lastNonPmsgInstallType = installType.value;
          if (schemeSelect.value === '' || schemeSelect.value === 'pmsgby') {
            schemeSelect.value = 'other';
          }
        }

        updateSystemConfigurationOptions();
      };

      const syncInstallFromScheme = () => {
        if (!schemeSelect || !installType) {
          updateSystemConfigurationOptions();
          return;
        }

        if (schemeSelect.value === 'pmsgby') {
          if (installType.value !== 'pmsgby') {
            installType.value = 'pmsgby';
          }
        } else if (schemeSelect.value === 'other') {
          if (installType.value === 'pmsgby') {
            installType.value = lastNonPmsgInstallType || '';
          }
          if (installType.value && installType.value !== 'pmsgby') {
            lastNonPmsgInstallType = installType.value;
          }
        }

        toggleApplicationField();
        updateSystemConfigurationOptions();
      };

      let lookupTimer = null;
      let lastLookupPhone = '';
      let activeLookupAbort = null;

      const normalisePhone = (value) => (value || '').replace(/\D+/g, '');

      const setLookupStatus = (message, tone) => {
        if (!lookupStatus) {
          return;
        }
        lookupStatus.textContent = message || '';
        if (tone) {
          lookupStatus.dataset.tone = tone;
        } else {
          delete lookupStatus.dataset.tone;
        }
      };

      const toggleApplicationField = () => {
        const isPmsgby = installType && installType.value === 'pmsgby';
        if (!applicationGroup || !applicationInput) return;

        if (isPmsgby) {
          applicationGroup.classList.remove('is-hidden');
          applicationInput.setAttribute('required', 'required');
        } else {
          applicationGroup.classList.add('is-hidden');
          applicationInput.removeAttribute('required');
          applicationInput.value = '';
        }
      };

      const clearError = () => {
        if (complaintError) {
          complaintError.textContent = '';
          complaintError.classList.add('is-hidden');
        }
      };

      const showError = (message) => {
        if (!complaintError) return;
        complaintError.textContent = message;
        complaintError.classList.remove('is-hidden');
      };

      const applyCustomerDetails = (customer) => {
        if (!customer || typeof customer !== 'object') {
          return;
        }

        const {
          name,
          email,
          siteAddress,
          systemSize,
          installType: install,
          applicationNumber,
          preferredContact,
          schemeType,
          systemConfiguration,
          systemConfigurationLabel,
          systemConfigurationRaw
        } = customer;

        if (name && complaintNameInput && complaintNameInput.value.trim() === '') {
          complaintNameInput.value = name;
        }

        if (email && complaintEmailInput && complaintEmailInput.value.trim() === '') {
          complaintEmailInput.value = email;
        }

        if (siteAddress && siteAddressInput && siteAddressInput.value.trim() === '') {
          siteAddressInput.value = siteAddress;
        }

        if (systemSize && systemSizeInput && systemSizeInput.value.trim() === '') {
          systemSizeInput.value = systemSize;
        }

        if (install && installType) {
          installType.value = install;
          installType.dispatchEvent(new Event('change', { bubbles: true }));
        }

        const derivedScheme = schemeType || (install === 'pmsgby' ? 'pmsgby' : '');
        if (schemeSelect && derivedScheme) {
          if (schemeSelect.value === '' || (schemeSelect.value === 'other' && derivedScheme === 'pmsgby')) {
            schemeSelect.value = derivedScheme;
          }
        }

        const resolvedSystemConfiguration = normaliseSystemConfigurationValue(
          systemConfiguration || systemConfigurationLabel || systemConfigurationRaw || ''
        );
        updateSystemConfigurationOptions(resolvedSystemConfiguration);
        if (
          resolvedSystemConfiguration &&
          systemConfigurationSelect &&
          systemConfigurationSelect.value === '' &&
          systemConfigurationSelect.querySelector(`option[value="${resolvedSystemConfiguration}"]`)
        ) {
          systemConfigurationSelect.value = resolvedSystemConfiguration;
        }

        if (applicationNumber && applicationInput) {
          applicationInput.value = applicationNumber;
        }

        if (preferredContact && preferredContactInput) {
          preferredContactInput.value = preferredContact;
        }
      };

      const performCustomerLookup = () => {
        if (!complaintPhoneInput) {
          return;
        }

        const digits = normalisePhone(complaintPhoneInput.value);
        if (digits.length < 10) {
          setLookupStatus('', null);
          lastLookupPhone = '';
          return;
        }

        if (digits === lastLookupPhone) {
          return;
        }

        lastLookupPhone = digits;

        if (activeLookupAbort) {
          activeLookupAbort.abort();
        }

        const controller = new AbortController();
        activeLookupAbort = controller;
        setLookupStatus('Looking up saved customer record…', 'info');

        fetch(`/api/public/customer-lookup?phone=${encodeURIComponent(digits)}`, { signal: controller.signal })
          .then((response) => {
            if (response.status === 404) {
              return null;
            }

            if (!response.ok) {
              throw new Error('Lookup failed');
            }

            return response.json();
          })
          .then((data) => {
            if (controller.signal.aborted) {
              return;
            }

            if (data && data.customer) {
              applyCustomerDetails(data.customer);
              const segmentLabel = data.customer.segmentLabel || 'customer registry';
              const reference = data.customer.reference || data.customer.entryId || '';
              const suffix = reference ? ` (Ref ${reference})` : '';
              setLookupStatus(`Details loaded from ${segmentLabel}${suffix}.`, 'success');
            } else {
              setLookupStatus('No saved customer record found for this number yet.', 'muted');
            }
          })
          .catch((error) => {
            if (controller.signal.aborted) {
              return;
            }

            console.warn('Customer lookup failed', error);
            setLookupStatus('Could not fetch customer details right now.', 'error');
          })
          .finally(() => {
            if (activeLookupAbort === controller) {
              activeLookupAbort = null;
            }
          });
      };

      const scheduleCustomerLookup = (force = false) => {
        if (!complaintPhoneInput) {
          return;
        }

        if (lookupTimer) {
          clearTimeout(lookupTimer);
          lookupTimer = null;
        }

        const digits = normalisePhone(complaintPhoneInput.value);
        if (digits.length < 10) {
          setLookupStatus('', null);
          lastLookupPhone = '';
          if (activeLookupAbort) {
            activeLookupAbort.abort();
            activeLookupAbort = null;
          }
          return;
        }

        if (force) {
          performCustomerLookup();
        } else {
          lookupTimer = window.setTimeout(performCustomerLookup, 600);
        }
      };

      if (complaintPhoneInput) {
        complaintPhoneInput.addEventListener('input', () => scheduleCustomerLookup(false));
        complaintPhoneInput.addEventListener('blur', () => scheduleCustomerLookup(true));
      }

      const buildComplaintSummary = () => {
        const formData = new FormData(complaintForm);
        const name = (formData.get('ComplaintName') || '').trim();
        const phone = (formData.get('ComplaintPhone') || '').trim();
        const email = (formData.get('ComplaintEmail') || '').trim();
        const installValue = formData.get('InstallType') || '';
        const installLabel = installType && installType.options[installType.selectedIndex]
          ? installType.options[installType.selectedIndex].textContent.trim()
          : installValue;
        const schemeValue = (formData.get('SchemeType') || '').trim();
        const systemConfigurationRaw = formData.get('SystemConfiguration') || '';
        const systemConfigurationValue = normaliseSystemConfigurationValue(systemConfigurationRaw);
        const schemeLabel = getSchemeLabel(schemeValue);
        const systemConfigurationLabel = getSystemConfigurationLabel(systemConfigurationValue);
        const applicationNumber = (formData.get('ApplicationNumber') || '').trim();
        const siteAddress = (formData.get('SiteAddress') || '').trim();
        const systemSize = (formData.get('SystemSize') || '').trim();
        const preferredContact = (formData.get('PreferredContact') || '').trim();
        const uniqueIssue = (formData.get('UniqueIssue') || '').trim();
        const selectedIssues = Array.from(issueInputs)
          .filter((input) => input.checked)
          .map((input) => ({
            value: input.value,
            label: input.dataset.label || input.value,
          }));

        if (!schemeValue) {
          showError('Select whether the installation is covered under the PM Surya Ghar Muft Bijli Yojana.');
          return null;
        }

        if (!systemConfigurationValue) {
          showError('Select the system configuration for this installation.');
          return null;
        }

        if (!selectedIssues.length && !uniqueIssue) {
          showError('Select an affected component or describe the issue so we can register your complaint.');
          return null;
        }

        clearError();

        const issueLabels = selectedIssues.map((issue) => issue.label);
        const issueValues = selectedIssues.map((issue) => issue.value);

        const summaryLines = [
          'Dakshayani service complaint',
          `Installation category: ${installLabel || 'Not specified'}`,
          `Customer name: ${name}`,
          `Phone: ${phone}`,
          `Scheme: ${schemeLabel || schemeValue}`,
          `System configuration: ${systemConfigurationLabel || systemConfigurationValue || 'Not specified'}`,
        ];

        if (email) {
          summaryLines.push(`Email: ${email}`);
        }

        if (installValue === 'pmsgby' && applicationNumber) {
          summaryLines.push(`PM Surya Ghar application #: ${applicationNumber}`);
        }

        summaryLines.push(`Site address: ${siteAddress || 'Not provided'}`);
        summaryLines.push(`Solar plant size: ${systemSize || 'Not provided'}`);

        if (issueLabels.length) {
          summaryLines.push('', 'Affected components:', `- ${issueLabels.join('\n- ')}`);
        }

        if (uniqueIssue) {
          summaryLines.push('', 'Issue details:', uniqueIssue);
        }

        if (preferredContact) {
          summaryLines.push('', `Preferred updates via: ${preferredContact}`);
        }

        summaryLines.push('', 'Logged via Dakshayani website');

        return {
          summaryText: summaryLines.join('\n'),
        };
      };

      if (installType) {
        installType.addEventListener('change', () => {
          if (installType.value && installType.value !== 'pmsgby') {
            lastNonPmsgInstallType = installType.value;
          }
          toggleApplicationField();
          syncSchemeFromInstall();
        });
        toggleApplicationField();
        syncSchemeFromInstall();
      }

      if (schemeSelect) {
        schemeSelect.addEventListener('change', () => {
          syncInstallFromScheme();
        });
      }

      updateSystemConfigurationOptions();

      complaintForm.addEventListener('submit', function (event) {
        event.preventDefault();
      });

      complaintForm.addEventListener('input', clearError);
      complaintForm.addEventListener('change', clearError);

      if (whatsappButton) {
        whatsappButton.addEventListener('click', function () {
          const summaryData = buildComplaintSummary();
          if (!summaryData) return;

          const { summaryText } = summaryData;

          const encodedSummary = encodeURIComponent(summaryText);
          window.open(`https://wa.me/918102401427?text=${encodedSummary}`, '_blank');
          window.open(`https://wa.me/917070278178?text=${encodedSummary}`, '_blank');
        });
      }

      if (emailButton) {
        emailButton.addEventListener('click', function () {
          const summaryData = buildComplaintSummary();
          if (!summaryData) return;

          const { summaryText } = summaryData;

          const subject = encodeURIComponent('Solar service complaint');
          const ccRecipients = ['connect@dakshayani.co.in', 'd.entranchi@gmail.com'];
          const mailto = `mailto:dakshayani.pmsgy@gmail.com?cc=${encodeURIComponent(ccRecipients.join(','))}&subject=${subject}&body=${encodeURIComponent(summaryText)}`;
          window.location.href = mailto;
        });
      }
    });
  </script>
  <script src="script.js" defer></script>
</body>
</html>
